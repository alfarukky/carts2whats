<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %></title>

    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Exo:300,500,800|Roboto&display=swap"
    />
    <link rel="stylesheet" href="/css/fontawesome.css" />
    <link rel="stylesheet" href="/css/bootstrap.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/aos.css" />
    <!-- Open Graph metadata for WhatsApp sharing -->
    <meta property="og:title" content="<%= post.title %>" />
    <meta
      property="og:description"
      content="<%= post.meta_description || post.excerpt || 'Read this post on Cart2Whats' %>"
    />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="<%= fullUrl %>" />
    <% if (post.og_image || post.featured_image) { %>
    <meta
      property="og:image"
      content="<%= req.protocol %>://<%= req.get('host') %><%= post.og_image || post.featured_image %>"
    />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <% } %>
  </head>
  <body>
    <%- include('partials/errorMsg') %>
    <%- include('partials/navbar') %>

    <div class="container mt-4">
      <% if (admin && isDraft) { %>
      <div class="alert alert-warning">
        <i class="fas fa-eye-slash"></i> <strong>Draft Preview</strong> - This
        post is not visible to the public
      </div>
      <% } %>

      <% if (admin) { %>
      <div class="admin-actions mb-3">
        <a href="/api/posts/" class="btn btn-sm btn-outline-primary">
          ‚Üê Back to Posts
        </a>
        <a
          href="/api/posts/admin/<%= post.id %>/edit"
          class="btn btn-sm btn-outline-secondary"
        >
          <i class="fas fa-edit"></i> Edit Post
        </a>
        <form
          action="/api/posts/admin/<%= post.id %>"
          method="GET"
          class="block-inline"
        >
          <button
            type="submit"
            class="btn btn-sm btn-outline-danger"
            onclick="
              return confirm('Are you sure you want to delete this post?');
            "
          >
            Delete
          </button>
        </form>
      </div>
      <% } %>

      <article class="post-single">
        <% if (post.featured_image) { %>
        <img
          src="<%= post.featured_image %>"
          alt="<%= post.title %>"
          class="img-fluid mb-4 rounded"
        />
        <% } %>

        <header class="post-header mb-4">
          <% if (post.type === 'event') { %>
          <span class="badge bg-info mb-2">üìÖ Event</span>
          <% } %>
          <h1><%= post.title %></h1>
          <small class="text-muted">
            Published on <%= new Date(post.created_at).toLocaleDateString() %>
          </small>
        </header>

        <% if (post.type === 'event') { %>
        <div class="event-info alert alert-info">
          <% if (post.event_date) { %>
          <p>
            <strong>üìÖ Date:</strong>
            <%= new Date(post.event_date).toLocaleDateString() %>
          </p>
          <% } %>
          <% if (post.event_location) { %>
          <p>
            <strong>üìç Location:</strong>
            <%= post.event_location %>
          </p>
          <% } %>
          <% 
          const whatsappMessage = post.whatsapp_template || `Hi! I'm interested in the event: ${post.title}`;
          const whatsappUrl = `https://wa.me/YOUR_NUMBER?text=${encodeURIComponent(whatsappMessage)}`;
        %>
          <a href="#" class="badge bg-success text-decoration-none">
            <i class="fab fa-whatsapp"></i> We'll be there!
          </a>
        </div>
        <% } %>

        <div class="post-content"><%- post.content %></div>

        <div class="post-actions mt-4">
          <% const whatsappShare =
          `https://wa.me/?text=${encodeURIComponent(fullUrl)}`; %>
          <a
            href="<%= whatsappShare %>"
            target="_blank"
            class="btn btn-success me-2 mb-2"
          >
            <i class="fab fa-whatsapp"></i> Share on WhatsApp
          </a>

          <button class="btn btn-outline-secondary" onclick="copyPostLink()">
            <i class="fas fa-copy"></i> Copy Link
          </button>
        </div>
      </article>
    </div>
    <%- include('partials/footer') %>

    <script>
      function copyPostLink() {
        const url = "<%= fullUrl %>";
        navigator.clipboard
          .writeText(url)
          .then(() => {
            alert("Link copied! Paste it in WhatsApp Status.");
          })
          .catch(() => {
            alert("Failed to copy link");
          });
      }
    </script>

    <script src="/js/bootstrap.bundle.min.js"></script>
    <script src="/js/carts.js"></script>
    <script src="/js/script.js"></script>
  </body>
</html>
