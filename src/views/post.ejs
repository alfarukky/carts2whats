<!DOCTYPE html>
<html lang="en">
  <%- include('partials/head') %>
  <body>
    <%- include('partials/errorMsg') %>
    <%- include('partials/navbar') %>

    <div class="container mt-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-heading"><%= title %></h2>
        <% if (admin && isAdminView) { %>
        <a href="/api/posts/admin/new" class="btn btn-primary btn-animate-1"
          >+ New Post</a
        >
        <% } %>
      </div>

      <% if (admin && isAdminView) { %>
      <!-- Admin Table View -->
      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Title</th>
              <th>Type</th>
              <th>Status</th>
              <th>Views</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% posts.forEach(post => { %>
            <tr>
              <td><%= post.title %></td>
              <td>
                <span
                  class="badge bg-<%= post.type === 'event' ? 'info' : 'secondary' %>"
                >
                  <%= post.type === 'event' ? 'Event' : 'Article' %>
                </span>
              </td>
              <td>
                <span
                  class="badge bg-<%= post.status === 'published' ? 'success' : 'warning' %>"
                >
                  <%= post.status %>
                </span>
              </td>
              <td><%= post.view_count || 0 %></td>
              <td><%= new Date(post.created_at).toLocaleDateString() %></td>
              <td>
                <a
                  href="/api/posts/<%= post.slug %>"
                  class="btn btn-sm btn-outline-primary mb-1"
                  target="_blank"
                  >View</a
                >
                <a
                  href="/api/posts/admin/<%= post.id %>/edit"
                  class="btn btn-sm btn-outline-secondary mb-1"
                  >Edit</a
                >
                <form
                  action="/api/posts/admin/<%= post.id %>"
                  method="GET"
                  class="block-inline"
                >
                  <button
                    type="submit"
                    class="btn btn-sm btn-outline-danger mb-1"
                    onclick="
                      return confirm(
                        'Are you sure you want to delete this post?',
                      );
                    "
                  >
                    Delete
                  </button>
                </form>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
      <% } else { %>
      <!-- Client Grid View -->
      <div class="row">
        <% posts.forEach(post => { %>
        <div
          class="col-md-6 col-lg-4 mb-4"
          data-aos="fade-up"
          data-aos-delay="300"
        >
          <div class="card blog-card h-100">
            <% if (post.featured_image) { %>
            <img
              src="<%= post.featured_image %>"
              class="card-img-top"
              alt="<%= post.title %>"
              data-aos="zoom-in"
              data-aos-duration="300"
            />
            <% } %>
            <div class="card-body d-flex flex-column">
              <% if (post.type === 'event') { %>
              <span
                class="badge bg-info mb-2 align-self-start"
                data-aos="fade-right"
                data-aos-duration="500"
                >üìÖ Event</span
              >
              <% } %>

              <h5 class="card-title">
                <a
                  href="/api/posts/<%= post.slug %>"
                  class="text-decoration-none"
                  ><%= post.title %></a
                >
              </h5>

              <% if (post.excerpt) { %>
              <p class="card-text"><%= post.excerpt %></p>
              <% } %>

              <% if (post.type === 'event' && post.event_date) { %>
              <div class="event-info mb-2">
                <small class="text-muted">
                  üìÖ <%= new Date(post.event_date).toLocaleDateString() %> <% if
                  (post.event_location) { %>
                  <br />üìç
                  <%= post.event_location %>
                  <% } %>
                </small>
              </div>
              <% } %>

              <a
                href="/api/posts/<%= post.slug %>"
                class="btn btn-outline-primary mt-auto btn-animate-1"
                data-aos="fade-up"
                data-aos-delay="150"
                >Read More</a
              >
            </div>
          </div>
        </div>
        <% }) %>
      </div>
      <% } %>
    </div>

    <%- include('partials/footer') %>
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script src="/js/carts.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/aos.js"></script>
    <script>
      AOS.init({
        duration: 700,
        easing: "ease-out-cubic",
        once: true,
        offset: 120,
      });
    </script>
  </body>
</html>
