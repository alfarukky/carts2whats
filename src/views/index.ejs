<!DOCTYPE html>
<html lang="en">
  <%- include("partials/head") %>
  <body>
    <!-- Top Banner -->
    <!-- <div class="bg-light py-1 border-bottom shadow-sm" data-aos="fade-down">
      <div class="container d-flex justify-content-between align-items-center">
        <div class="overflow-hidden flex-grow-1 me-3">
          <span class="deal-marquee">
            Super Value Deals - Save more with coupons
          </span>
        </div>
        <button class="btn btn-sm btn-secondary btn-animate">
          Quick Actions
        </button>
      </div>
    </div> -->
    <!-- Main Navbar -->
    <%- include('partials/navbar') %>
    <%- include("partials/errorMsg") %>
    <header>
      <!-- Hero Slider -->
      <div class="hero hero--static py-6">
        <div class="container">
          <div class="row align-items-center g-4">
            <div class="col-lg-7">
              <span
                class="badge bg-success-subtle text-success fw-semibold mb-3"
              >
                <%= content.hero.badge %>
              </span>

              <h1 class="display-4 fw-extrabold lh-tight mb-3">
                <%= content.hero.title %>
                <span class="text-success text-heading"><%= content.branding.siteName %></span>
              </h1>

              <p class="lead text-muted mb-4">
                <%= content.hero.description %>
              </p>

              <!-- CTA buttons -->
              <div class="d-flex flex-wrap gap-2 mb-5">
                <a
                  href="#popular-products"
                  class="btn btn-success btn-lg btn-animate-1"
                >
                  <%= content.hero.ctaPrimary %>
                </a>
                <a href="/api/products" class="btn btn-outline-success btn-lg">
                  <%= content.hero.ctaSecondary %>
                </a>
              </div>
            </div>

            <!-- Right image -->
            <div class="col-lg-5 d-none d-lg-block">
              <div class="hero-media rounded-4 shadow-sm overflow-hidden">
                <img
                  src="/images/hero1.jpeg"
                  class="img-fluid rounded-4"
                  alt="Fresh groceries"
                />
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <main>
      <section class="container my-5">
        <div class="row g-4">
          <% promoCards.forEach(card => { %>
          <div class="col-md-4 mb-3" data-aos="zoom-in">
            <div
              class="promo-card p-4 h-100 d-flex flex-column justify-content-between <%= promoColors[card.id] %>"
            >
              <div>
                <h4 class="fw-bold mb-3"><%- card.title %></h4>
                <% if (card.subtitle) { %>
                <p class="mb-1"><%- card.subtitle %></p>
                <% } %>

                <% if (card.small_text) { %>
                <p class="mb-4"><%- card.small_text %></p>
                <% } %>
              </div>

              <div class="text-end">
                <img
                  src="/uploads/<%= card.image %>"
                  class="img-fluid promo-img"
                  onerror="this.src='/images/placeholder-product.svg'; this.onerror=null;"
                />
              </div>

              <a
                href="<%= card.button_link || '/api/products' %>"
                class="btn btn-dark mt-3"
                >Shop Now</a
              >
            </div>

            <% if (admin) { %>
            <div class="my-2">
              <a
                href="/api/admin/promo/<%= card.id %>/edit"
                class="btn btn-warning btn-sm btn-animate-1"
                >Edit</a
              >
            </div>
            <% } %>
          </div>
          <% }); %>
        </div>
      </section>
      <!-- Categories -->
      <section class="container py-5">
        <!-- Section Title -->
        <div class="text-center mb-5">
          <h2 class="fw-bold text-heading"><%= content.sections.categories.title %></h2>
          <div class="mx-auto line__small line--orange"></div>
          <div class="mx-auto line line--orange"></div>
        </div>

        <!-- Category Grid -->
        <div class="row g-4 text-center">
          <% popularCategories.forEach((category, index) => { %>
          <div
            class="col-6 col-md-4 col-lg-2"
            data-aos="fade-up"
            data-aos-delay="<%= (index % 6) * 100 + 100 %>"
          >
            <a href="/api/products?category=<%= encodeURIComponent(category.name) %>" class="text-decoration-none text-dark">
              <div class="p-3">
                <div
                  class="category__item bg-light rounded-circle mx-auto d-flex align-items-center justify-content-center"
                >
                  <img
                    src="<%= category.image ? '/uploads/' + category.image : '/images/placeholder-category.svg' %>"
                    alt="<%= category.name %>"
                    class="category__img img-fluid"
                    onerror="this.src='/images/placeholder-category.svg'; this.onerror=null;"
                  />
                </div>
                <p class="fw-semibold mt-3"><%= category.name %></p>
              </div>
            </a>
          </div>
          <% }) %>
        </div>
      </section>
      <!-- household Collections  -->
      <section class="services py-5" id="household-collections">
        <div class="container">
          <!-- Header -->
          <div class="text-center mb-5">
            <h2 class="fw-bold text-heading"><%= content.sections.household.title %></h2>
            <div class="mx-auto line line--blue"></div>
            <div class="mx-auto line__small line--blue"></div>

            <p class="lead mt-3 text-muted w-75 mx-auto">
              <%= content.sections.household.subtitle %>
            </p>
          </div>

          <!-- Product Collection Row -->
          <div class="row mt-3">
            <% content.sections.household.collections.forEach((collection, index) => { %>
            <div class="col-lg-4 mb-3" data-aos="fade-up">
              <div class="service_card">
                <div class="service_card__side service_card__side--front">
                  <div class="service_card__picture service_card__picture--<%= index + 4 %>"></div>
                  <h4 class="service_card__heading">
                    <span class="service_card__heading-span service_card__heading-span--<%= index + 4 %>">
                      <%= collection.name %>
                    </span>
                  </h4>
                  <div class="service_card__details">
                    <ul class="service_card__details__list">
                      <% collection.features.forEach(feature => { %>
                      <li>
                        <i class="icon-color--<%= index + 1 %> fas fa-check-circle"></i>
                        <%= feature %>
                      </li>
                      <% }) %>
                    </ul>
                  </div>
                </div>
                <div class="service_card__side service_card__side--back service_card__side--back-<%= index + 4 %>">
                  <h3><%= collection.name %></h3>
                  <p class="lead">
                    <%= collection.description %>
                  </p>
                  <a href="<%= collection.link %>" class="card_btn">
                    <%= collection.buttonText %>
                  </a>
                </div>
              </div>
            </div>
            <% }) %>
          </div>
        </div>
      </section>
      <section class="popular-products py-5" id="popular-products">
        <div class="container">
          <!-- Section Header -->
          <div class="text-center mb-3">
            <h2 class="fw-bold text-heading display-6"><%= content.sections.products.title %></h2>
            <div class="mx-auto line__small line--green"></div>
            <div class="mx-auto line line--green"></div>
          </div>

          <!-- If no popular products -->
          <% if (popularProducts.length === 0) { %>
          <p class="text-center text-muted fs-5">
            <%= content.sections.products.emptyMessage %>
          </p>
          <% if (admin) { %>
          <div class="text-center mb-3">
            <a href="/api/products" class="btn btn-success btn-animate-1">
              <%= content.sections.products.addButton %>
            </a>
          </div>
          <% } %>
          <% } else { %>
          <% if (admin) { %>
          <div class="text-center mb-3">
            <a href="/api/products" class="btn btn-success btn-animate-1">
              <%= content.sections.products.addButton %>
            </a>
          </div>
          <% } %>
          <!-- Product Grid -->
          <div class="row g-4">
            <% popularProducts.forEach(product => { %>
            <div class="col-6 col-md-4 col-lg-3 col-xl-2" data-aos="zoom-in-up">
              <!-- Product Card -->
              <div class="product-card p-3 border rounded-3 position-relative">
                <!-- Badge -->
                <span
                  class="badge <%= product.badgeClass %> position-absolute top-0 start-0 m-2"
                >
                  <%= product.badge !== "none" ? product.badge.toUpperCase() :
                  "" %>
                </span>

                <!-- Out of Stock Badge -->
                <% if (product.is_out_of_stock) { %>
                <span class="badge bg-danger position-absolute top-0 end-0 m-2">
                  OUT OF STOCK
                </span>
                <% } %>

                <!-- Product Image -->
                <div class="product-img text-center">
                  <img
                    src="/uploads/<%= product.image %>"
                    alt="<%= product.name %>"
                    class="img-fluid"
                    width="200"
                    height="200"
                    loading="lazy"
                    onerror="this.src='/images/placeholder-product.svg'; this.onerror=null;"
                  />
                </div>

                <!-- Category -->
                <p class="text-muted small mt-3 mb-1">
                  <%= product.category %>
                </p>

                <!-- Name -->
                <div class="fw-bold"><%= product.name %></div>

                <!-- Rating -->
                <div class="rating text-warning mb-1">
                  <% 
                    const validRating = Math.max(0, Math.min(5, parseFloat(product.rating) || 0));
                  %>
                  <% for (let s = 1; s <= 5; s++) { %> <% if (s <= validRating) { %>
                  <i class="fa fa-star"></i>
                  <% } else { %>
                  <i class="fa fa-star-o"></i>
                  <% } %>
                  <% } %>
                  <span class="text-muted small">(<%= Math.max(0, Math.min(10000, parseInt(product.reviews) || 0)) %>)</span>
                </div>

                <!-- Price -->
                <p class="mb-1 d-flex justify-content-between">
                  <span class="fw-bold text-dark">₦<%= product.price %></span>
                  <% if (product.old_price) { %>
                  <span class="text-muted text-decoration-line-through small">
                    ₦<%= product.old_price %>
                  </span>
                  <% } %>
                </p>

                <% if (product.is_out_of_stock) { %>
                <button
                  type="button"
                  class="btn btn-secondary btn-sm w-100"
                  disabled
                >
                  <i class="fa fa-ban me-2"></i> Out of Stock
                </button>
                <% } else { %>
                <button
                  type="button"
                  class="btn btn-outline-success btn-sm w-100 add-to-cart-btn"
                  data-id="<%= product.id %>"
                  data-name="<%= product.name %>"
                  data-price="<%= product.price %>"
                  data-image="/uploads/<%= product.image %>"
                >
                  <i class="fa fa-shopping-cart me-2"></i> Add to Cart
                </button>
                <% } %>
              </div>

              <!-- Admin Controls -->
              <% if (admin) { %>
              <div class="mt-2 d-flex justify-content-between">
                <a
                  href="/api/products/<%= product.id %>/edit"
                  class="btn btn-warning btn-sm w-50 me-1"
                  >Edit</a
                >

                <form action="/api/products/<%= product.id %>/toggle-popular" method="POST" class="w-50 ms-1">
                  <button type="submit" class="btn btn-danger btn-sm w-100">Remove</button>
                </form>
              </div>
              <% } %>
            </div>
            <% }); %>
          </div>

          <% } %>
        </div>
      </section>

      <section class="services py-5 bg-white">
        <div class="container">
          <div class="row text-center g-4">
            <!-- Service 1 -->
            <div class="col-md-6 col-lg-3" data-aos="fade-up">
              <div class="service-box p-4 border rounded-3 h-100">
                <div class="icon mb-3 text-primary fs-1">
                  <i class="fa-solid fa-truck-fast"></i>
                </div>
                <h5 class="fw-bold"><%= content.sections.services.delivery.title %></h5>
                <p class="text-muted mb-0">
                  <%= content.sections.services.delivery.description %>
                </p>
              </div>
            </div>

            <!-- Service 2 -->
            <div class="col-md-6 col-lg-3" data-aos="fade-up">
              <div class="service-box p-4 border rounded-3 h-100">
                <div class="icon mb-3 text-success fs-1">
                  <i class="fa-solid fa-lock"></i>
                </div>
                <h5 class="fw-bold"><%= content.sections.services.payments.title %></h5>
                <p class="text-muted mb-0">
                  <%= content.sections.services.payments.description %>
                </p>
              </div>
            </div>

            <!-- Service 3 -->
            <div class="col-md-6 col-lg-3" data-aos="fade-up">
              <div class="service-box p-4 border rounded-3 h-100">
                <div class="icon mb-3 text-warning fs-1">
                  <i class="fa-solid fa-rotate-left"></i>
                </div>
                <h5 class="fw-bold"><%= content.sections.services.returns.title %></h5>
                <p class="text-muted mb-0">
                  <%= content.sections.services.returns.description %>
                </p>
              </div>
            </div>

            <!-- Service 4 -->
            <div class="col-md-6 col-lg-3" data-aos="fade-up">
              <div class="service-box p-4 border rounded-3 h-100">
                <div class="icon mb-3 text-danger fs-1">
                  <i class="fa-solid fa-headset"></i>
                </div>
                <h5 class="fw-bold"><%= content.sections.services.support.title %></h5>
                <p class="text-muted mb-0">
                  <%= content.sections.services.support.description %>
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
    <%-include("partials/footer")  %>
    <!-- Back to Top Button -->
    <button id="toTopBtn" class="to-top-btn">
      <i class="fa-solid fa-arrow-up"></i>
    </button>
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script src="/js/carts.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/aos.js"></script>
    <script>
      AOS.init({
        duration: 800,
        easing: "ease-out-quart",
        once: true, // animation happens once
        offset: 120,
      });
    </script>
  </body>
</html>
